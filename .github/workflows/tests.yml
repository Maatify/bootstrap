name: ğŸ§ª Maatify Bootstrap CI

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  test:
    name: ğŸ” Run PHPUnit Tests
    runs-on: ubuntu-latest

    services:
      redis:
        image: redis:7
        ports:
          - 6379:6379
      mongo:
        image: mongo:7
        ports:
          - 27017:27017
      mysql:
        image: mysql:8
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: maatify_test
        ports:
          - 3306:3306

    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'
          coverage: none
          extensions: mbstring, intl, pdo_mysql, redis

      - name: ğŸ§° Install Dependencies
        run: composer install --no-interaction --prefer-dist --no-progress

      - name: ğŸ§ª Run Tests
        env:
          APP_ENV: testing
          CI: true
        run: composer run-script test

      - name: âœ… Validate Docs
        run: |
          test -f docs/README.full.md
          test -f docs/CHANGELOG.md
          echo "âœ… Documentation verified successfully."

  build:
    name: ğŸ§± Build Docker Image
    runs-on: ubuntu-latest
    needs: [ test ]
    steps:
      - uses: actions/checkout@v4
      - name: ğŸ³ Build Docker Image
        run: docker build -t maatify/bootstrap:latest .
